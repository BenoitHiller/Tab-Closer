<!DOCTYPE html>
<html>
  <head><title>Tab Closer settings</title>
  </head>
  <style>
    body {
      padding:0;
      margin:0;
    }
    h1 {
      color:#A8A8A8;
    }
    #header {
      position:relative;
      padding:15px 0 15px 50px;
      background-color:#545454;
      right:0;
      left:0;
      height:80px;
    }
    #content {
      position:relative;
      height:auto;
      width:630px;
      margin-left:50px;
    }
    #help,#settings {
      float:left;
      height: auto;
      width: 300px;
      float:left;
      text-align:left;
    }
    #help {
      size:100%;
      background-color:white;
    }
    #settings {
      size:100%;
      margin-left:30px;
    }
    #notifications {
      padding-top:15px;
      display:none;
    }
    .matcher {
    }
    .error {
      background-color:#A8A8A8;
    }



  </style>
  <script type="text/javascript" src="util.js"></script>
  <script type="text/javascript" src="matcher.js"></script>
  <script>
    function notify(text) {
      var notification = document.getElementById("notifications");
      notification.innerText = text;
      notification.style.display = "block";
    }

    function save_settings(manager) {
      var syntax_error = false;
      var options = document.getElementById("matchers");
      var window_setting = document.getElementById("windowSetting");
      var regex_setting = document.getElementById("regexSetting");
      syntax_error = manager.save_matchers(regex_setting.checked);
      if (!syntax_error) {
        notify("Could not save settings! There are errors in your matchers.");
      }
      else {
        localStorage["window-setting"] = window_setting.checked; 
        localStorage["regex-setting"] = regex_setting.checked; 
        if (manager) {
          notify("Settings saved successfully."); 
        }
        else {
          notify("Settings saved but there are no matchers so it probably won't do anything.");
          }
        }
    }

    function load_matchers(manager) {
      init();
      if (localStorage["window-setting"] === "true") {
        document.getElementById("windowSetting").checked = true;
      }
      manager.load_matchers();
    }

    var pageManager = new MatcherManager(false)

    function setup(manager) {
      manager.add_to_page('matchers');
      load_matchers(manager);
    }

  </script>
  <body onload="setup(pageManager)">
    <div id="header"><h1>Tab Closer Settings</h1></div>
    <div id="content">
      <div id="help">
        <h2>Help</h2>
        When you click on the garbage can icon the extension will close all of your open pages that match one of the URL matchers on the left.
        <br> 
        <br> 
        I am just using the tab api directly at the moment so your matchers must have to have the following form:
        <pre>PROTOCOL://HOST/PATH</pre>

        Where PROTOCOL can be any of:
        <ul>
          <li>*</li>
          <li>http</li>
          <li>https</li>
          <li>file</li>
          <li>ftp</li>
        </ul>

        The * is a wildcard and it will match any of the other options.
        <br>
        <br>
        HOST is any valid address. You can use a *. at the begining only to match anything string to the left of the period.
        <br>
        <br>
        PATH can be any string with wildcards anywhere within it.
        <br>
        <br>
        You can check out <a href="http://code.google.com/chrome/extensions/match_patterns.html">Google's page</a> on the topic for examples or a more thorough description.
      </div>
      <div id="settings">
        <div id="notifications"></div>
        <h2>Settings:</h2>
        <input type="checkbox" id="windowSetting" name="windowSetting" value="onlyThis"> Close tabs only in current window.<br>
        <input type="checkbox" id="regexSetting" name="regexSetting" value="onlyThis"> Use slower regex matching.<br>
        <h2>Matchers:</h2>
        <div id="matchers">
        </div>
        <br>
        <button onclick="pageManager.add_matcher_to_page(pageManager.add_matcher())">Add</button> <!--XXX update to reflect new location of regex option -->
        <button onclick="save_settings(pageManager)">Save</button>
      </div>
    </div>
  </body>
</html>
